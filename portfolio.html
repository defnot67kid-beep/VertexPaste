<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortfolioHub - Create Your Professional Portfolio</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Highlight.js for syntax highlighting in code projects -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f52e0;
            --primary-light: #a5b4fc;
            --secondary: #8b5cf6;
            --accent: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --info: #3b82f6;
            --dark: #03050a;
            --dark-light: #0c0f16;
            --dark-card: #14181f;
            --dark-input: #1e242c;
            --text: #ffffff;
            --text-dim: #94a3b8;
            --text-dimmer: #64748b;
            --border: rgba(255,255,255,0.05);
            --border-light: rgba(255,255,255,0.1);
            --shadow: 0 25px 50px -12px rgba(0,0,0,0.8);
            --gradient-primary: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navbar */
        .navbar {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-radius: 12px;
            border: 1px solid #334155;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
            cursor: pointer;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 15px;
            background: #1e293b;
            border-radius: 8px;
            border: 1px solid #334155;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-info:hover {
            border-color: var(--primary);
            background: #2d3a4f;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .admin-badge {
            background: var(--accent);
            color: black;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            font-weight: bold;
        }

        /* Portfolio Preview Styles */
        .portfolio-preview {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid #334155;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .portfolio-preview:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2);
        }

        .portfolio-header {
            padding: 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            position: relative;
        }

        .portfolio-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            border: 3px solid white;
            margin-bottom: 10px;
        }

        .portfolio-name {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
        }

        .portfolio-title {
            color: rgba(255,255,255,0.9);
            font-size: 14px;
        }

        .portfolio-body {
            padding: 20px;
            flex: 1;
        }

        .portfolio-bio {
            color: var(--text-dim);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .portfolio-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            color: var(--text-dim);
            font-size: 13px;
        }

        .portfolio-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .portfolio-link {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-dim);
            text-decoration: none;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .portfolio-link:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: #2d3a4f;
        }

        .portfolio-link i {
            color: var(--primary);
        }

        .portfolio-footer {
            padding: 15px 20px;
            border-top: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1e293b;
        }

        .portfolio-views {
            color: var(--text-dim);
            font-size: 12px;
        }

        .portfolio-actions {
            display: flex;
            gap: 8px;
        }

        /* Portfolio Page Styles */
        .portfolio-container {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid #334155;
            overflow: hidden;
        }

        .portfolio-cover {
            height: 300px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            position: relative;
        }

        .portfolio-cover-edit {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .portfolio-profile-section {
            padding: 0 30px 30px;
            position: relative;
            margin-top: -60px;
        }

        .portfolio-profile-header {
            display: flex;
            align-items: flex-end;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .portfolio-profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            font-weight: bold;
            color: var(--primary);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        .portfolio-profile-info {
            flex: 1;
        }

        .portfolio-profile-name {
            font-size: 48px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .portfolio-profile-title {
            font-size: 20px;
            color: var(--primary-light);
            margin-bottom: 15px;
        }

        .portfolio-profile-meta {
            display: flex;
            gap: 30px;
            color: var(--text-dim);
        }

        .portfolio-profile-bio {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            line-height: 1.8;
            font-size: 16px;
        }

        /* Links Grid */
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .link-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .link-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
        }

        .link-card a {
            text-decoration: none;
            color: inherit;
        }

        .link-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 15px;
        }

        .link-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 8px;
        }

        .link-url {
            color: var(--primary);
            font-size: 14px;
            margin-bottom: 10px;
            word-break: break-all;
        }

        .link-description {
            color: var(--text-dim);
            font-size: 14px;
            line-height: 1.5;
        }

        .link-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .link-card:hover .link-actions {
            opacity: 1;
        }

        .link-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: #0f172a;
            border: 1px solid #334155;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .link-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .link-action-btn.delete:hover {
            background: var(--danger);
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .dashboard-tabs {
            display: flex;
            gap: 12px;
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 100px;
        }

        .dashboard-tab {
            padding: 10px 24px;
            background: transparent;
            border: none;
            color: var(--text-dim);
            font-weight: 600;
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dashboard-tab.active {
            background: var(--gradient-primary);
            color: white;
        }

        /* Create Portfolio Form */
        .create-portfolio {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid #334155;
            margin-bottom: 30px;
        }

        .create-portfolio h2 {
            margin-bottom: 20px;
            color: #f1f5f9;
            font-size: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            font-size: 14px;
            color: white;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        /* Add Link Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            border: 1px solid #334155;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #f1f5f9;
        }

        .link-type-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .link-type-btn {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 10px;
            color: var(--text-dim);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .link-type-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .link-type-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Auth Forms */
        .auth-container {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 40px;
            border: 1px solid #334155;
            max-width: 400px;
            margin: 50px auto;
            box-shadow: var(--shadow);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #334155;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #94a3b8;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-logout {
            background: #ef4444;
            color: white;
        }

        .btn-logout:hover {
            background: #dc2626;
        }

        /* Portfolio Grid */
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Notification */
        .copy-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            animation: slideIn 0.3s ease;
            z-index: 1000;
        }

        .copy-notification.warning {
            background: var(--danger);
        }

        .copy-notification.info {
            background: var(--info);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .loading::after {
            content: "";
            width: 40px;
            height: 40px;
            border: 4px solid #334155;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Share Link */
        .share-link-container {
            background: #1e293b;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .share-link {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .share-link input {
            flex: 1;
            background: #0f172a;
            border: 1px solid #334155;
            padding: 10px;
            border-radius: 6px;
            color: var(--primary);
            font-family: monospace;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .portfolio-profile-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .portfolio-profile-meta {
                justify-content: center;
            }
            
            .dashboard-tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="logo" onclick="window.location.hash='#dashboard'">PortfolioHub</div>
            <div class="nav-buttons" id="navButtons"></div>
        </nav>

        <!-- Main Content Area -->
        <div id="mainContent">
            <div class="loading"></div>
        </div>

        <!-- Add Link Modal -->
        <div id="linkModal" class="modal">
            <div class="modal-content">
                <h3><i class="fas fa-plus-circle"></i> Add Link to Portfolio</h3>
                
                <div class="link-type-selector" id="linkTypeSelector">
                    <div class="link-type-btn selected" data-type="website" onclick="window.selectLinkType('website')">
                        <i class="fas fa-globe"></i><br>Website
                    </div>
                    <div class="link-type-btn" data-type="github" onclick="window.selectLinkType('github')">
                        <i class="fab fa-github"></i><br>GitHub
                    </div>
                    <div class="link-type-btn" data-type="linkedin" onclick="window.selectLinkType('linkedin')">
                        <i class="fab fa-linkedin"></i><br>LinkedIn
                    </div>
                    <div class="link-type-btn" data-type="twitter" onclick="window.selectLinkType('twitter')">
                        <i class="fab fa-twitter"></i><br>Twitter
                    </div>
                </div>

                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="linkTitle" placeholder="e.g., My Portfolio, GitHub Profile">
                </div>

                <div class="form-group">
                    <label>URL</label>
                    <input type="url" id="linkUrl" placeholder="https://...">
                </div>

                <div class="form-group">
                    <label>Description (optional)</label>
                    <textarea id="linkDescription" rows="2" placeholder="Brief description of this link..."></textarea>
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-primary" onclick="window.saveLink()">
                        <i class="fas fa-save"></i> Save Link
                    </button>
                    <button class="btn btn-logout" onclick="window.closeLinkModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Share Modal -->
        <div id="shareModal" class="modal">
            <div class="modal-content">
                <h3><i class="fas fa-share-alt"></i> Share Your Portfolio</h3>
                <div class="share-link">
                    <input type="text" id="shareLink" readonly>
                    <button class="btn btn-primary" onclick="window.copyShareLink()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button class="btn btn-logout" onclick="window.closeShareModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, query, orderBy, where, updateDoc, arrayUnion, arrayRemove, increment, deleteDoc, Timestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAupBkllyicDPD9O6CmX4mS4sF5z96mqxc",
            authDomain: "vertexpaste.firebaseapp.com",
            projectId: "vertexpaste",
            storageBucket: "vertexpaste.firebasestorage.app",
            messagingSenderId: "255275350380",
            appId: "1:255275350380:web:7be4e8add2cb5b04045b49"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // ============ APP STATE ============
        let currentUser = null;
        let allPortfolios = [];
        let deviceId = null;
        let currentPortfolioId = null;
        let selectedLinkType = 'website';

        // ============ INITIALIZE ============
        function init() {
            // Generate or retrieve device ID
            deviceId = localStorage.getItem('portfolio_device_id');
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('portfolio_device_id', deviceId);
            }

            // Auth state observer
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    try {
                        // Check if user exists in Firestore
                        const userDoc = await getDoc(doc(db, 'users', user.uid));
                        
                        if (!userDoc.exists()) {
                            // Create new user profile
                            await setDoc(doc(db, 'users', user.uid), {
                                displayName: user.displayName || user.email.split('@')[0],
                                email: user.email,
                                createdAt: new Date().toISOString(),
                                isAdmin: false,
                                portfolioViews: 0,
                                portfolioLinks: []
                            });
                            
                            currentUser = {
                                uid: user.uid,
                                email: user.email,
                                displayName: user.displayName || user.email.split('@')[0],
                                isAdmin: false,
                                portfolioViews: 0,
                                portfolioLinks: []
                            };
                        } else {
                            const userData = userDoc.data();
                            currentUser = {
                                uid: user.uid,
                                email: user.email,
                                displayName: userData.displayName || user.displayName || user.email.split('@')[0],
                                isAdmin: userData.isAdmin || false,
                                portfolioViews: userData.portfolioViews || 0,
                                portfolioLinks: userData.portfolioLinks || []
                            };
                        }
                        
                        // Load all portfolios
                        await loadAllPortfolios();
                        
                        // Handle routing
                        handleRouting();
                    } catch (error) {
                        console.error('Auth error:', error);
                        handleRouting();
                    }
                } else {
                    currentUser = null;
                    await loadAllPortfolios();
                    handleRouting();
                }
                
                updateNavbar(user);
            });
            
            // Check URL hash on load
            window.addEventListener('hashchange', handleRouting);
            handleRouting();
        }

        // ============ LOAD ALL PORTFOLIOS ============
        async function loadAllPortfolios() {
            try {
                const portfoliosQuery = query(collection(db, 'portfolios'));
                const portfoliosSnapshot = await getDocs(portfoliosQuery);
                
                allPortfolios = [];
                portfoliosSnapshot.forEach((doc) => {
                    allPortfolios.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                console.log('Loaded', allPortfolios.length, 'portfolios');
            } catch (error) {
                console.error('Error loading portfolios:', error);
                allPortfolios = [];
            }
        }

        // ============ UPDATE NAVBAR ============
        function updateNavbar(user) {
            const navButtons = document.getElementById('navButtons');
            if (user) {
                const initial = (user.displayName || user.email || 'U').charAt(0).toUpperCase();
                navButtons.innerHTML = `
                    <div class="user-info" onclick="window.location.hash='#portfolio-${user.uid}'">
                        <div class="user-avatar">${initial}</div>
                        <span>${user.displayName || user.email}</span>
                    </div>
                    <button class="btn btn-logout" onclick="window.logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                `;
            } else {
                navButtons.innerHTML = `
                    <button class="btn btn-primary" onclick="window.showAuth()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                `;
            }
        }

        // ============ HANDLE ROUTING ============
        function handleRouting() {
            const hash = window.location.hash;
            
            if (hash.startsWith('#portfolio-')) {
                const userId = hash.replace('#portfolio-', '');
                viewPortfolio(userId);
                return;
            }
            
            if (hash === '#dashboard' || hash === '#my-portfolio') {
                if (currentUser) {
                    renderDashboard(hash === '#my-portfolio' ? 'mine' : 'all');
                } else {
                    showAuth();
                }
                return;
            }
            
            if (!currentUser) {
                showAuth();
            } else {
                window.location.hash = '#dashboard';
                renderDashboard('all');
            }
        }

        // ============ SHOW AUTH ============
        window.showAuth = function() {
            const container = document.getElementById('mainContent');
            container.innerHTML = `
                <div class="auth-container">
                    <div class="auth-tabs">
                        <div class="auth-tab active" onclick="window.switchTab('login')">Login</div>
                        <div class="auth-tab" onclick="window.switchTab('signup')">Sign Up</div>
                    </div>

                    <!-- Login Form -->
                    <div id="loginForm" class="auth-form active">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="loginEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" placeholder="Enter your password">
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="window.loginWithEmail()">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                        <button class="btn btn-success" style="width: 100%;" onclick="window.loginWithGoogle()">
                            <i class="fab fa-google"></i> Login with Google
                        </button>
                    </div>

                    <!-- Signup Form -->
                    <div id="signupForm" class="auth-form">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="signupName" placeholder="Enter your name">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="signupEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="signupPassword" placeholder="Enter your password">
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="window.signupWithEmail()">
                            <i class="fas fa-user-plus"></i> Sign Up
                        </button>
                        <button class="btn btn-success" style="width: 100%;" onclick="window.loginWithGoogle()">
                            <i class="fab fa-google"></i> Sign up with Google
                        </button>
                    </div>
                </div>
            `;
        };

        // ============ SWITCH AUTH TABS ============
        window.switchTab = function(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
        };

        // ============ AUTH FUNCTIONS ============
        window.signupWithEmail = async function() {
            const name = document.getElementById('signupName')?.value;
            const email = document.getElementById('signupEmail')?.value;
            const password = document.getElementById('signupPassword')?.value;

            if (!email || !password || !name) {
                showNotification('Please fill in all fields', true);
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(userCredential.user, {
                    displayName: name
                });
                showNotification('Account created successfully!');
            } catch (error) {
                showNotification(getUserFriendlyError(error), true);
            }
        };

        window.loginWithEmail = async function() {
            const email = document.getElementById('loginEmail')?.value;
            const password = document.getElementById('loginPassword')?.value;

            if (!email || !password) {
                showNotification('Please fill in all fields', true);
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showNotification('Login successful!');
            } catch (error) {
                showNotification(getUserFriendlyError(error), true);
            }
        };

        window.loginWithGoogle = async function() {
            try {
                await signInWithPopup(auth, googleProvider);
                showNotification('Login successful!');
            } catch (error) {
                showNotification(getUserFriendlyError(error), true);
            }
        };

        window.logout = async function() {
            try {
                await signOut(auth);
                window.location.hash = '';
                showNotification('Logged out successfully');
            } catch (error) {
                showNotification(getUserFriendlyError(error), true);
            }
        };

        // ============ USER FRIENDLY ERROR MESSAGES ============
        function getUserFriendlyError(error) {
            const errorCode = error.code;
            
            switch(errorCode) {
                case 'auth/email-already-in-use':
                    return 'This email is already registered. Please login instead.';
                case 'auth/invalid-email':
                    return 'Please enter a valid email address.';
                case 'auth/weak-password':
                    return 'Password should be at least 6 characters.';
                case 'auth/wrong-password':
                    return 'Incorrect password. Please try again.';
                case 'auth/user-not-found':
                    return 'No account found with this email.';
                default:
                    return 'An error occurred. Please try again.';
            }
        }

        // ============ VIEW PORTFOLIO ============
        async function viewPortfolio(userId) {
            const container = document.getElementById('mainContent');
            container.innerHTML = '<div class="loading"></div>';

            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                
                if (!userDoc.exists()) {
                    container.innerHTML = `
                        <div class="auth-container" style="text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ef4444; margin-bottom: 16px;"></i>
                            <h2>Portfolio Not Found</h2>
                            <p style="color: var(--text-dim); margin: 20px 0;">The portfolio you're looking for doesn't exist.</p>
                            <button class="btn btn-primary" onclick="window.location.hash='#dashboard'">
                                <i class="fas fa-home"></i> Back to Dashboard
                            </button>
                        </div>
                    `;
                    return;
                }
                
                const portfolioUser = {
                    uid: userId,
                    ...userDoc.data()
                };
                
                // Get portfolio links
                const links = portfolioUser.portfolioLinks || [];
                
                // Check if this is the user's own portfolio
                const isOwnPortfolio = currentUser && currentUser.uid === userId;
                
                // Increment portfolio view (unless it's the owner)
                if (currentUser && currentUser.uid !== userId) {
                    await updateDoc(doc(db, 'users', userId), {
                        portfolioViews: increment(1)
                    });
                } else if (!currentUser) {
                    await updateDoc(doc(db, 'users', userId), {
                        portfolioViews: increment(1)
                    });
                }
                
                await renderPortfolioView(portfolioUser, links, isOwnPortfolio);
                
            } catch (error) {
                console.error('Error loading portfolio:', error);
                container.innerHTML = `
                    <div class="auth-container" style="text-align: center;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ef4444; margin-bottom: 16px;"></i>
                        <h2>Error Loading Portfolio</h2>
                        <p style="color: var(--text-dim); margin: 20px 0;">Please try again.</p>
                        <button class="btn btn-primary" onclick="window.location.hash='#dashboard'">
                            <i class="fas fa-home"></i> Back to Dashboard
                        </button>
                    </div>
                `;
            }
        }

        // ============ RENDER PORTFOLIO VIEW ============
        async function renderPortfolioView(portfolioUser, links, isOwnPortfolio) {
            const container = document.getElementById('mainContent');
            
            const initial = (portfolioUser.displayName || 'U').charAt(0).toUpperCase();
            const joinDate = portfolioUser.createdAt ? new Date(portfolioUser.createdAt).toLocaleDateString() : 'Unknown';
            const portfolioUrl = `${window.location.origin}${window.location.pathname}#portfolio-${portfolioUser.uid}`;
            
            // Generate links HTML
            let linksHTML = '';
            links.forEach((link, index) => {
                const icon = getLinkIcon(link.type);
                
                linksHTML += `
                    <div class="link-card" onclick="window.open('${escapeHtml(link.url)}', '_blank')">
                        <div class="link-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="link-title">${escapeHtml(link.title)}</div>
                        <div class="link-url">${escapeHtml(link.url)}</div>
                        ${link.description ? `<div class="link-description">${escapeHtml(link.description)}</div>` : ''}
                        
                        ${isOwnPortfolio ? `
                        <div class="link-actions" onclick="event.stopPropagation()">
                            <div class="link-action-btn" onclick="window.editLink(${index})">
                                <i class="fas fa-edit"></i>
                            </div>
                            <div class="link-action-btn delete" onclick="window.deleteLink(${index})">
                                <i class="fas fa-trash"></i>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = `
                <div class="portfolio-container">
                    <div class="portfolio-cover">
                        ${isOwnPortfolio ? `
                        <div class="portfolio-cover-edit" onclick="window.editCover()">
                            <i class="fas fa-camera"></i> Change Cover
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="portfolio-profile-section">
                        <div class="portfolio-profile-header">
                            <div class="portfolio-profile-avatar">${initial}</div>
                            <div class="portfolio-profile-info">
                                <h1 class="portfolio-profile-name">${escapeHtml(portfolioUser.displayName || 'Anonymous')}</h1>
                                <div class="portfolio-profile-title">${escapeHtml(portfolioUser.title || 'Professional Portfolio')}</div>
                                <div class="portfolio-profile-meta">
                                    <span><i class="fas fa-eye"></i> ${portfolioUser.portfolioViews || 0} views</span>
                                    <span><i class="fas fa-link"></i> ${links.length} links</span>
                                    <span><i class="fas fa-calendar"></i> Joined ${joinDate}</span>
                                </div>
                            </div>
                            
                            <div class="portfolio-actions">
                                <button class="btn btn-primary" onclick="window.copyToClipboard('${portfolioUrl}')">
                                    <i class="fas fa-share-alt"></i> Share
                                </button>
                                ${isOwnPortfolio ? `
                                <button class="btn btn-success" onclick="window.openLinkModal()">
                                    <i class="fas fa-plus"></i> Add Link
                                </button>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="portfolio-profile-bio">
                            ${escapeHtml(portfolioUser.bio || 'No bio yet. Add a bio to tell others about yourself!')}
                            ${isOwnPortfolio ? `
                            <div style="margin-top: 10px;">
                                <button class="btn btn-primary btn-icon" onclick="window.editBio()">
                                    <i class="fas fa-edit"></i> Edit Bio
                                </button>
                            </div>
                            ` : ''}
                        </div>
                        
                        <h2 style="margin: 30px 0 20px;"><i class="fas fa-link"></i> Links</h2>
                        
                        <div class="links-grid">
                            ${linksHTML || '<p style="color: var(--text-dim); grid-column: 1/-1; text-align: center;">No links added yet.</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        // ============ GET LINK ICON ============
        function getLinkIcon(type) {
            switch(type) {
                case 'github': return 'fab fa-github';
                case 'linkedin': return 'fab fa-linkedin';
                case 'twitter': return 'fab fa-twitter';
                default: return 'fas fa-globe';
            }
        }

        // ============ OPEN LINK MODAL ============
        window.openLinkModal = function() {
            document.getElementById('linkModal').classList.add('active');
            document.getElementById('linkTitle').value = '';
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkDescription').value = '';
            selectedLinkType = 'website';
            
            // Reset type selector
            document.querySelectorAll('.link-type-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector('[data-type="website"]').classList.add('selected');
        };

        window.closeLinkModal = function() {
            document.getElementById('linkModal').classList.remove('active');
        };

        window.selectLinkType = function(type) {
            selectedLinkType = type;
            document.querySelectorAll('.link-type-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('selected');
        };

        // ============ SAVE LINK ============
        window.saveLink = async function() {
            if (!currentUser) return;
            
            const title = document.getElementById('linkTitle').value;
            const url = document.getElementById('linkUrl').value;
            const description = document.getElementById('linkDescription').value;
            
            if (!title || !url) {
                showNotification('Please fill in title and URL', true);
                return;
            }
            
            try {
                const userRef = doc(db, 'users', currentUser.uid);
                const userDoc = await getDoc(userRef);
                const currentLinks = userDoc.data().portfolioLinks || [];
                
                const newLink = {
                    type: selectedLinkType,
                    title: title,
                    url: url,
                    description: description,
                    addedAt: new Date().toISOString()
                };
                
                await updateDoc(userRef, {
                    portfolioLinks: [...currentLinks, newLink]
                });
                
                showNotification('Link added successfully!');
                closeLinkModal();
                
                // Refresh portfolio view
                await viewPortfolio(currentUser.uid);
                
            } catch (error) {
                console.error('Error saving link:', error);
                showNotification('Error saving link', true);
            }
        };

        // ============ DELETE LINK ============
        window.deleteLink = async function(index) {
            if (!currentUser || !confirm('Are you sure you want to delete this link?')) return;
            
            try {
                const userRef = doc(db, 'users', currentUser.uid);
                const userDoc = await getDoc(userRef);
                const currentLinks = [...(userDoc.data().portfolioLinks || [])];
                
                currentLinks.splice(index, 1);
                
                await updateDoc(userRef, {
                    portfolioLinks: currentLinks
                });
                
                showNotification('Link deleted');
                await viewPortfolio(currentUser.uid);
                
            } catch (error) {
                console.error('Error deleting link:', error);
                showNotification('Error deleting link', true);
            }
        };

        // ============ EDIT BIO ============
        window.editBio = async function() {
            const newBio = prompt('Enter your bio:', currentUser.bio || '');
            if (newBio === null) return;
            
            try {
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    bio: newBio
                });
                
                currentUser.bio = newBio;
                showNotification('Bio updated!');
                await viewPortfolio(currentUser.uid);
                
            } catch (error) {
                showNotification('Error updating bio', true);
            }
        };

        // ============ RENDER DASHBOARD ============
        async function renderDashboard(filter = 'all') {
            await loadAllPortfolios();
            
            const container = document.getElementById('mainContent');
            
            // Filter portfolios
            let filteredPortfolios = allPortfolios;
            
            // Get stats
            const totalPortfolios = allPortfolios.length;
            const myPortfolio = currentUser ? allPortfolios.find(p => p.uid === currentUser.uid) : null;
            
            // Generate portfolios grid
            let portfoliosHTML = '';
            filteredPortfolios.forEach(portfolio => {
                const initial = (portfolio.displayName || 'U').charAt(0).toUpperCase();
                const linksCount = portfolio.portfolioLinks?.length || 0;
                const views = portfolio.portfolioViews || 0;
                const portfolioUrl = `#portfolio-${portfolio.uid}`;
                
                portfoliosHTML += `
                    <div class="portfolio-preview" onclick="window.location.hash='${portfolioUrl}'">
                        <div class="portfolio-header">
                            <div class="portfolio-avatar-large">${initial}</div>
                            <div class="portfolio-name">${escapeHtml(portfolio.displayName || 'Anonymous')}</div>
                            <div class="portfolio-title">${escapeHtml(portfolio.title || 'Professional Portfolio')}</div>
                        </div>
                        <div class="portfolio-body">
                            <div class="portfolio-bio">
                                ${escapeHtml((portfolio.bio || 'No bio yet').substring(0, 100))}${portfolio.bio?.length > 100 ? '...' : ''}
                            </div>
                            <div class="portfolio-stats">
                                <span><i class="fas fa-link"></i> ${linksCount} links</span>
                                <span><i class="fas fa-eye"></i> ${views} views</span>
                            </div>
                            <div class="portfolio-links">
                                ${(portfolio.portfolioLinks || []).slice(0, 3).map(link => `
                                    <div class="portfolio-link" onclick="event.stopPropagation(); window.open('${escapeHtml(link.url)}', '_blank')">
                                        <i class="${getLinkIcon(link.type)}"></i> ${escapeHtml(link.title)}
                                    </div>
                                `).join('')}
                                ${linksCount > 3 ? `<div class="portfolio-link">+${linksCount - 3} more</div>` : ''}
                            </div>
                        </div>
                        <div class="portfolio-footer">
                            <div class="portfolio-views">
                                <i class="fas fa-calendar"></i> Joined ${portfolio.createdAt ? new Date(portfolio.createdAt).toLocaleDateString() : 'Recently'}
                            </div>
                            <div class="portfolio-actions">
                                <button class="btn btn-primary btn-icon" onclick="event.stopPropagation(); window.copyToClipboard('${window.location.origin}${window.location.pathname}${portfolioUrl}')">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = `
                <div class="dashboard active">
                    <div class="dashboard-header">
                        <h1><i class="fas fa-home"></i> PortfolioHub Dashboard</h1>
                        <div class="dashboard-tabs">
                            <button class="dashboard-tab ${filter === 'all' ? 'active' : ''}" onclick="window.renderDashboard('all')">
                                <i class="fas fa-globe"></i> All Portfolios
                            </button>
                            ${currentUser ? `
                            <button class="dashboard-tab ${filter === 'mine' ? 'active' : ''}" onclick="window.location.hash='#my-portfolio'">
                                <i class="fas fa-user"></i> My Portfolio
                            </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="stat-card" style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; text-align: center;">
                            <h3 style="font-size: 2rem; color: var(--primary);">${totalPortfolios}</h3>
                            <div class="stat-label" style="color: var(--text-dim);">Total Portfolios</div>
                        </div>
                        ${currentUser ? `
                        <div class="stat-card" style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; text-align: center;">
                            <h3 style="font-size: 2rem; color: var(--primary);">${myPortfolio?.portfolioLinks?.length || 0}</h3>
                            <div class="stat-label" style="color: var(--text-dim);">My Links</div>
                        </div>
                        <div class="stat-card" style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; text-align: center;">
                            <h3 style="font-size: 2rem; color: var(--primary);">${myPortfolio?.portfolioViews || 0}</h3>
                            <div class="stat-label" style="color: var(--text-dim);">My Views</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    ${!currentUser ? `
                    <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 16px; padding: 40px; text-align: center; margin-bottom: 30px;">
                        <h2 style="font-size: 2rem; color: white; margin-bottom: 20px;">Create Your Professional Portfolio Today!</h2>
                        <p style="color: rgba(255,255,255,0.9); margin-bottom: 30px;">Showcase your work, share your links, and connect with others.</p>
                        <button class="btn btn-primary" style="background: white; color: var(--primary);" onclick="window.showAuth()">
                            <i class="fas fa-sign-in-alt"></i> Get Started
                        </button>
                    </div>
                    ` : ''}
                    
                    <h2 style="margin: 30px 0 20px;"><i class="fas fa-users"></i> Featured Portfolios</h2>
                    
                    <div class="portfolio-grid">
                        ${portfoliosHTML || '<p style="color: var(--text-dim); text-align: center;">No portfolios found.</p>'}
                    </div>
                </div>
            `;
        }

        // ============ COPY TO CLIPBOARD ============
        window.copyToClipboard = async function(text) {
            try {
                await navigator.clipboard.writeText(text);
                showNotification('Link copied to clipboard!');
            } catch (err) {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification('Link copied to clipboard!');
            }
        };

        // ============ SHARE MODAL ============
        window.showShareModal = function(link) {
            document.getElementById('shareLink').value = link;
            document.getElementById('shareModal').classList.add('active');
        };

        window.closeShareModal = function() {
            document.getElementById('shareModal').classList.remove('active');
        };

        window.copyShareLink = function() {
            const link = document.getElementById('shareLink');
            link.select();
            navigator.clipboard.writeText(link.value)
                .then(() => {
                    showNotification('Link copied to clipboard!');
                    closeShareModal();
                });
        };

        // ============ NOTIFICATION ============
        function showNotification(message, isWarning = false) {
            const notification = document.createElement('div');
            notification.className = `copy-notification ${isWarning ? 'warning' : 'info'}`;
            notification.innerHTML = `
                <i class="fas ${isWarning ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ============ ESCAPE HTML ============
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // ============ CLOSE MODAL ON OUTSIDE CLICK ============
        window.onclick = function(event) {
            const shareModal = document.getElementById('shareModal');
            if (event.target === shareModal) {
                closeShareModal();
            }
            
            const linkModal = document.getElementById('linkModal');
            if (event.target === linkModal) {
                closeLinkModal();
            }
        };

        // ============ EXPOSE FUNCTIONS TO WINDOW ============
        window.renderDashboard = renderDashboard;
        window.editCover = function() {
            showNotification('Cover image feature coming soon!', true);
        };
        window.editLink = function(index) {
            showNotification('Edit link feature coming soon!', true);
        };

        // ============ INITIALIZE ============
        init();
    </script>
</body>
</html>
